<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PXWeb v0 → v2 (POST → GET)</title>
  <meta name="description" content="Konverter PXWeb v0 POST-JSON til presis PXWeb v2 GET-URL. Kan auto-fylle host, tabell og språk fra v0-URL/cURL." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main>
    <header>
      <h1>PXWeb v0 → v2</h1>
      <p class="lead">Lim inn PXWeb v0 POST-JSON (SSB). Vi bygger <strong>alltid</strong> v2-URL med mønsteret
      <code>https://&lt;domene&gt;/api/pxwebapi/v2/tables/&lt;TABLE&gt;/data?lang=&lt;LANG&gt;</code>.</p>
    </header>

    <section class="card">
      <label for="v0Input">v0-URL eller cURL (valgfritt)</label>
      <input id="v0Input" placeholder="f.eks. curl -X POST https://data.ssb.no/.../v0/... -d '{ ... }' eller en gammel v0-nettadresse" />
      <div class="row">
        <button id="autofillBtn" class="ghost">Autofyll fra v0-URL/cURL</button>
        <button id="clearUrlBtn" class="ghost">Tøm URL-felt</button>
      </div>
      <div id="autofillMsg" class="hint"></div>
    </section>

    <section class="card">
      <div class="grid">
        <div>
          <label for="host">Domene (ikke lim inn /api...)</label>
          <input id="host" value="https://data.ssb.no" />
          <div class="hint">Paster du en hel URL med /v0/ osv., så plukker vi ut bare domenet.</div>
        </div>
        <div>
          <label for="tableId">Tabell-ID</label>
          <input id="tableId" placeholder="09429" />
          <div class="hint">Eksempel: 09429</div>
        </div>
        <div>
          <label for="lang">Språk</label>
          <input id="lang" value="no" />
          <div class="hint">f.eks. no / en</div>
        </div>
      </div>

      <label for="postBody">PXWeb v0 POST-body (JSON)</label>
      <textarea id="postBody" rows="14" placeholder='Lim inn v0 POST-JSON, f.eks.:
{
  "query": [
    { "code": "Region", "selection": { "filter": "agg_single:KommGjeldende", "values": ["3101","3103"] } },
    { "code": "Nivaa", "selection": { "filter": "item", "values": ["00","01","02a","11","03a","04a","09a"] } },
    { "code": "ContentsCode", "selection": { "filter": "item", "values": ["Personer"] } },
    { "code": "Tid", "selection": { "filter": "item", "values": ["2023","2024"] } }
  ],
  "response": { "format": "json-stat2" }
}'></textarea>

      <div class="row">
        <button id="btn">Konverter</button>
        <button id="clearBtn" class="ghost">Tøm</button>
      </div>

      <div id="basePreview" class="hint"></div>

      <label for="output">v2 GET-URL</label>
      <input id="output" readonly />
      <div class="row">
        <button id="copyBtn">Kopier</button>
        <a id="openBtn" class="ghost" href="#" target="_blank" rel="noopener">Åpne i ny fane</a>
      </div>

      <details class="tip">
        <summary>Hva garanteres</summary>
        <ul>
          <li>Base-URL <em>tvinges</em> til <code>https://&lt;domene&gt;/api/pxwebapi/v2/tables/&lt;TABLE&gt;/data?lang=&lt;LANG&gt;</code>.</li>
          <li>Kun <code>valueCodes[Dim]=csv</code> legges til etter <code>lang</code>.</li>
          <li>Rekkefølgen fra <code>query[]</code> bevares. Braketter (<code>[]</code>) encodes ikke.</li>
        </ul>
      </details>
    </section>

    <footer>
      <p>Statisk app – alt kjører i nettleseren. © 2025 – MIT</p>
    </footer>
  </main>

  <script src="main.js"></script>
</body>
</html>
